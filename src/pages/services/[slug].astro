---
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import BookCallLink from '@/components/BookCallLink.astro';
import CtaBar from '@/components/CtaBar.astro';
import JsonLd from '@/components/JsonLd.astro';
import Section from '@/components/Section.astro';
import { services, getServiceBySlug } from '@/lib/content/services';

export function getStaticPaths() {
  return services.map((service) => ({
    params: { slug: service.slug },
  }));
}

const { slug } = Astro.params;
const service = getServiceBySlug(slug!)!;

const priceRangeMatch = service.representativePrice.match(/\$([0-9,]+)\s?[–-]\s?\$([0-9,]+)/);
const priceSpecification = priceRangeMatch
  ? {
      "@type": "PriceSpecification",
      priceCurrency: "USD",
      minPrice: Number(priceRangeMatch[1].replace(/,/g, "")),
      maxPrice: Number(priceRangeMatch[2].replace(/,/g, ""))
    }
  : undefined;

const serviceLd = {
  "@context": "https://schema.org",
  "@type": "Service",
  name: service.name,
  description: service.summary,
  serviceType: service.shortName,
  areaServed: "United States",
  provider: {
    "@type": "LocalBusiness",
    name: "BUILD3R",
    url: "https://build3r.io"
  },
  hasOfferCatalog: {
    "@type": "OfferCatalog",
    name: service.name,
    itemListElement: service.deliverables.map((item) => ({
      "@type": "Offer",
      itemOffered: {
        "@type": "Service",
        name: item
      }
    }))
  },
  offers: priceSpecification
};
---

<MarketingLayout title={`${service.name} | BUILD3R`} description={service.summary}>
  <div class="space-y-24 pb-24">
    <JsonLd data={serviceLd} />
    <section class="relative isolate overflow-hidden">
      <div aria-hidden="true" class="pointer-events-none absolute inset-0 -z-10 bg-gradient-to-br from-brand-blue-50 via-white to-brand-purple-50"></div>
      <div aria-hidden="true" class="pointer-events-none absolute right-[-15%] top-[-10%] h-[28rem] w-[28rem] rounded-full bg-gradient-to-br from-brand-purple-200/50 via-brand-blue-200/40 to-transparent blur-3xl"></div>
      <div aria-hidden="true" class="pointer-events-none absolute inset-0 -z-10 pattern-dots" style="--pattern-color: rgba(37, 99, 235, 0.12);"></div>
      <div class="relative mx-auto w-full max-w-4xl px-6 pb-20 pt-24 md:px-8">
        <p class="inline-flex items-center gap-2 rounded-full border border-brand-blue-200/60 bg-white/70 px-4 py-2 text-xs font-semibold uppercase tracking-[0.5em] text-brand-blue-600 shadow-soft">
          {service.shortName}
        </p>
        <h1 class="mt-6 text-4xl font-semibold tracking-tight text-ink-900 md:text-5xl">{service.name}</h1>
        <p class="mt-4 text-lg leading-relaxed text-ink-600">{service.summary}</p>
        <div class="mt-8 flex flex-col gap-4 text-sm text-ink-500 sm:flex-row sm:items-center sm:gap-8">
          <span class="font-semibold text-ink-900">Timeline: {service.timelineWeeks}</span>
          <span class="font-semibold text-ink-900">Representative price: {service.representativePrice}</span>
          <BookCallLink source={`service-${service.slug}`} class="rounded-full border border-ink-200/60 px-4 py-2 text-sm font-semibold text-brand-blue-600 transition hover:border-brand-blue-400 hover:text-brand-blue-700">
            {service.cta} →
          </BookCallLink>
        </div>
      </div>
    </section>

    <Section class="bg-white" eyebrow="Problem we solve" title="Why teams hire this engagement" description={service.problem} />

    <Section class="bg-white" title="Deliverables" description="You get tangible outputs, documentation, and enablement to keep momentum after launch.">
      <ul class="grid gap-4 text-sm text-ink-600 md:grid-cols-2">
        {service.deliverables.map((item) => (
          <li class="rounded-xl2 border border-ink-200/60 bg-white/90 p-5 shadow-soft">{item}</li>
        ))}
      </ul>
    </Section>

    <Section class="bg-white" title="Outcomes you can expect" description="Engagements are measured against the metrics that matter to your business.">
      <ul class="grid gap-4 text-sm text-ink-600 md:grid-cols-2">
        {service.outcomes.map((item) => (
          <li class="rounded-xl2 border border-ink-200/60 bg-white/90 p-5 shadow-soft">{item}</li>
        ))}
      </ul>
    </Section>

    <Section class="bg-white" title="FAQs">
      <div class="space-y-4">
        {service.faqs.map((faq) => (
          <details class="group rounded-xl2 border border-ink-200/60 bg-white/90 p-6 shadow-soft">
            <summary class="flex cursor-pointer items-center justify-between text-base font-semibold text-ink-900">
              {faq.question}
              <span class="text-sm text-brand-blue-500 group-open:rotate-45">+</span>
            </summary>
            <p class="mt-3 text-sm leading-relaxed text-ink-600">{faq.answer}</p>
          </details>
        ))}
      </div>
    </Section>

    <CtaBar
      title={service.cta}
      description="Schedule a working session to review goals, constraints, and next steps."
      primaryHref="/book-a-call"
      primaryLabel="Book a call"
      secondaryHref="/pricing"
      secondaryLabel="Open the estimator"
    />
  </div>
</MarketingLayout>
